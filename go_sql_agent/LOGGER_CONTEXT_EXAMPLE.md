# Использование контекстного логгера

Логгер теперь поддерживает передачу контекста со стадиями выполнения. Это позволяет автоматически добавлять информацию о текущей стадии в любые логи.

## Основные функции

### WithStage - добавление стадии в контекст

```go
ctx := logger.WithStage(context.Background(), "Инициализация")
```

### GetStageFromContext - получение стадии из контекста

```go
stage := logger.GetStageFromContext(ctx) // "Инициализация"
```

## Методы логирования с контекстом

Все стандартные методы логирования теперь имеют версии с суффиксом `Ctx`:

- `DebugCtx(ctx, format, args...)`
- `InfoCtx(ctx, format, args...)`
- `WarnCtx(ctx, format, args...)`
- `ErrorCtx(ctx, format, args...)`
- `FatalCtx(ctx, format, args...)`
- `SuccessCtx(ctx, format, args...)`
- `ProgressCtx(ctx, format, args...)`
- `StageCtx(ctx, name)`

## Пример использования

```go
package main

import (
    "context"
    "github.com/20twomay/ai-med-brat/go_sql_agent/internal/logger"
)

func main() {
    // Инициализация логгера
    logger.Init(logger.DefaultConfig())

    ctx := context.Background()

    // Стадия 1: Загрузка конфигурации
    ctx = logger.WithStage(ctx, "Загрузка конфигурации")
    logger.StageCtx(ctx, "Загрузка конфигурации")
    logger.InfoCtx(ctx, "Читаем файл config.yaml")
    logger.SuccessCtx(ctx, "Конфигурация загружена")

    // Стадия 2: Подключение к БД
    ctx = logger.WithStage(ctx, "Подключение к БД")
    logger.StageCtx(ctx, "Подключение к базе данных")
    logger.InfoCtx(ctx, "Подключаемся к localhost:5432")
    logger.SuccessCtx(ctx, "Успешно подключились к БД")

    // Стадия 3: Выполнение запросов
    ctx = logger.WithStage(ctx, "Выполнение запросов")
    logger.StageCtx(ctx, "Выполнение SQL запросов")
    logger.InfoCtx(ctx, "Выполняем SELECT * FROM users")
    logger.SuccessCtx(ctx, "Получено 100 записей")
}
```

## Вывод в лог

Теперь каждое сообщение будет содержать информацию о текущей стадии:

```
[2025-12-11 10:30:15] [INFO] [Загрузка конфигурации] Запуск стадии [Загрузка конфигурации]
[2025-12-11 10:30:15] [INFO] [Загрузка конфигурации] Читаем файл config.yaml
[2025-12-11 10:30:15] [INFO] [Загрузка конфигурации] ✅ Конфигурация загружена
[2025-12-11 10:30:16] [INFO] [Подключение к БД] Запуск стадии [Подключение к базе данных]
[2025-12-11 10:30:16] [INFO] [Подключение к БД] Подключаемся к localhost:5432
[2025-12-11 10:30:16] [INFO] [Подключение к БД] ✅ Успешно подключились к БД
[2025-12-11 10:30:17] [INFO] [Выполнение запросов] Запуск стадии [Выполнение SQL запросов]
[2025-12-11 10:30:17] [INFO] [Выполнение запросов] Выполняем SELECT * FROM users
[2025-12-11 10:30:17] [INFO] [Выполнение запросов] ✅ Получено 100 записей
```

## Преимущества

1. **Автоматическая категоризация** - каждый лог автоматически помечается текущей стадией
2. **Легкая фильтрация** - можно легко найти все логи относящиеся к конкретной стадии
3. **Улучшенная читаемость** - сразу понятно на какой стадии произошло событие
4. **Совместимость** - старые методы без `Ctx` продолжают работать
5. **Гибкость** - можно передавать контекст через всю цепочку вызовов

## Рекомендации

1. Всегда используйте `WithStage` при переходе к новой стадии
2. Используйте короткие, но понятные названия стадий (например, "Инициализация LLM", "Подключение к БД")
3. Передавайте контекст через параметры функций
4. В начале каждой важной стадии вызывайте `StageCtx` для явной индикации